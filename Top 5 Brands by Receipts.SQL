--Top 5 Brands by receipts scanned among users 21 and over?

WITH OVER_21_POPULATION AS (
  SELECT
  ID AS USER_ID
  ,DATE_DIFF(CURRENT_DATE(), DATE(BIRTH_DATE), YEAR) AS AGE
  FROM `fetch.user`
  WHERE DATE_DIFF(CURRENT_DATE(), DATE(BIRTH_DATE), YEAR) >= 21
  AND BIRTH_DATE IS NOT NULL
  ORDER BY BIRTH_DATE,AGE DESC
)

SELECT
FP.BRAND AS BRAND
,COUNT(DISTINCT RECEIPT_ID) AS RECEIPT_SCANS
FROM `fetch.transaction` AS FT
LEFT JOIN OVER_21_POPULATION AS P
  ON P.USER_ID = FT.USER_ID
LEFT JOIN `fetch.products` AS FP
  ON FP.BARCODE = FT.BARCODE
WHERE BRAND IS NOT NULL
GROUP BY BRAND
ORDER BY RECEIPT_SCANS DESC
LIMIT 5